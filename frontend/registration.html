<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register - POLIS</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 2rem; overflow-x: hidden; transition: background 0.3s, color 0.3s; }
    body.dark-mode { background: #1e1e1e; color: #ddd; }

    .bg-animation { position: fixed; top:0; left:0; width:100%; height:100%; overflow:hidden; z-index:1; }
    .bg-animation::before { content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); animation: rotate 20s linear infinite; }
    @keyframes rotate { from{transform:rotate(0deg);} to{transform:rotate(360deg);} }

    .navbar { position: fixed; top:0; left:0; width:100%; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); display:flex; justify-content:space-between; align-items:center; padding:0.5rem 2rem; z-index:20; border-bottom:1px solid rgba(0,0,0,0.1); transition: background 0.3s, color 0.3s; }
    .navbar.dark-mode { background: rgba(30,30,30,0.95); border-bottom:1px solid rgba(255,255,255,0.1); }
    .navbar .logo { display:flex; align-items:center; gap:0.5rem; font-size:1.5rem; font-weight:700; text-decoration:none; color:#333; }
    .navbar.dark-mode .logo { color: #ddd; }
    .navbar .logo i { font-size:1.8rem; color:#ffdd57; }
    .navbar .nav-links { display:flex; align-items:center; gap:1.5rem; }
    .navbar .nav-links a { text-decoration:none; color:#333; font-weight:500; transition: color 0.3s; }
    .navbar.dark-mode .nav-links a { color:#ddd; }
    .navbar .nav-links a:hover { color:#667eea; }
    .dark-toggle { cursor:pointer; font-size:1.2rem; color:#333; transition: color 0.3s; }
    .dark-mode .dark-toggle { color:#ddd; }

    .registration-container { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border-radius:20px; padding:3rem; width:100%; max-width:500px; margin:6rem auto 2rem; box-shadow:0 20px 40px rgba(0,0,0,0.1); position:relative; z-index:2; animation: slideUp 0.6s ease-out; transition: background 0.3s, color 0.3s; }
    body.dark-mode .registration-container { background: rgba(40,40,40,0.9); color:#ddd; }
    @keyframes slideUp { from{opacity:0; transform:translateY(30px);} to{opacity:1; transform:translateY(0);} }

    .registration-header { text-align:center; margin-bottom:2rem; }
    .registration-header h1 { font-size:2rem; font-weight:700; margin-bottom:0.5rem; }
    .registration-header p { font-size:0.95rem; color:#666; }

    .form-group { margin-bottom:1.5rem; position:relative; }
    .form-group label { display:block; margin-bottom:0.5rem; font-weight:500; font-size:0.9rem; }
    .input-wrapper { position:relative; }
    .form-group input { width:100%; padding:1rem 1rem 1rem 3rem; border:2px solid #e1e5e9; border-radius:12px; font-size:1rem; transition: all 0.3s ease; background:white; }
    body.dark-mode .form-group input { background:#2c2c2c; color:#ddd; border-color:#555; }
    .form-group input:focus { outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,0.1); }
    .input-icon { position:absolute; left:1rem; top:50%; transform:translateY(-50%); color:#999; transition: color 0.3s ease; }
    .toggle-password { cursor:pointer; position:absolute; right:1rem; top:50%; transform:translateY(-50%); color:#999; }
    .toggle-password:hover { color:#333; }

    .strength-bar { height:6px; background-color:#e1e5e9; border-radius:3px; overflow:hidden; margin-bottom:0.5rem; }
    .strength-fill { height:100%; width:0%; border-radius:3px; transition: all 0.3s ease; }
    .strength-weak { background-color:#dc3545; }
    .strength-medium { background-color:#ffc107; }
    .strength-strong { background-color:#28a745; }
    .strength-text { font-size:0.8rem; color:#666; }

    .error-message { color:#dc3545; font-size:0.85rem; margin-top:0.5rem; display:none; animation:shake 0.5s ease-in-out; }
    @keyframes shake { 0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);} }
    .success-message { background: linear-gradient(135deg,#28a745,#20c997); color:white; padding:1rem; border-radius:12px; text-align:center; margin-bottom:1.5rem; display:none; animation:slideDown 0.3s ease-out; }
    @keyframes slideDown { from{opacity:0; transform:translateY(-10px);} to{opacity:1; transform:translateY(0);} }

    .btn { width:100%; padding:1rem; border:none; border-radius:12px; font-size:1rem; font-weight:600; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:0.5rem; transition: all 0.3s ease; }
    .btn-primary { background: linear-gradient(135deg,#667eea,#764ba2); color:white; }
    .btn-primary:hover { transform:translateY(-2px); box-shadow:0 10px 25px rgba(102,126,234,0.3); }
    .btn-primary:disabled { opacity:0.7; cursor:not-allowed; transform:none; }

    .links { text-align:center; margin-top:2rem; }
    .links a { color:#667eea; text-decoration:none; font-weight:500; transition: color 0.3s; }
    .links a:hover { color:#764ba2; }
    .links p { margin-bottom:0.5rem; color:#666; }

    .form-row { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    @media(max-width:480px){ .form-row{ grid-template-columns:1fr; } }
    @media(max-width:600px){ .registration-container{ padding:2rem; margin:1rem; } .registration-header h1{ font-size:1.5rem; } }
  </style>
</head>
<body>

<div class="bg-animation"></div>

<div class="navbar" id="navbar">
  <a href="home.html" class="logo"><i class="fas fa-shield-alt"></i> POLIS</a>
  <div class="nav-links">
    <a href="home.html">Home</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
    <i class="fas fa-moon dark-toggle" id="darkToggle"></i>
  </div>
</div>

<div class="registration-container">
  <div class="registration-header">
    <h1>Create Account</h1>
    <p>Join POLIS and start managing cases efficiently</p>
  </div>

  <div id="success-message" class="success-message"><i class="fas fa-check-circle"></i> Registration successful! Redirecting to login...</div>
  <div id="api-error" class="error-message"></div>

  <form id="registration-form" onsubmit="handleRegistration(event)">
    <div class="form-row">
      <div class="form-group">
        <label for="fullname">Full Name</label>
        <div class="input-wrapper">
          <input type="text" id="fullname" placeholder="Enter your full name" required />
          <i class="fas fa-user input-icon"></i>
        </div>
      </div>
      <div class="form-group">
        <label for="username">Username</label>
        <div class="input-wrapper">
          <input type="text" id="username" placeholder="Choose a username" required />
          <i class="fas fa-at input-icon"></i>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <div class="input-wrapper">
        <input type="email" id="email" placeholder="Enter your email" required />
        <i class="fas fa-envelope input-icon"></i>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="dob">Date of Birth</label>
        <div class="input-wrapper">
          <input type="date" id="dob" required />
          <i class="fas fa-calendar input-icon"></i>
        </div>
      </div>
      <div class="form-group">
        <label for="age">Age</label>
        <div class="input-wrapper">
          <input type="number" id="age" placeholder="Auto-calculated" required readonly />
          <i class="fas fa-birthday-cake input-icon"></i>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="phone">Phone Number</label>
      <div class="input-wrapper">
        <input type="tel" id="phone" placeholder="Enter your phone number" required />
        <i class="fas fa-phone input-icon"></i>
      </div>
    </div>

    <div class="form-group">
      <label for="password">Password</label>
      <div class="input-wrapper">
        <input type="password" id="password" placeholder="Create a strong password" required />
        <i class="fas fa-lock input-icon"></i>
        <i class="fas fa-eye toggle-password" onclick="togglePassword(this,'password')"></i>
      </div>
      <div class="password-strength">
        <div class="strength-bar"><div id="strength" class="strength-fill"></div></div>
        <div id="strength-text" class="strength-text">Password strength</div>
      </div>
    </div>

    <div class="form-group">
      <label for="confirm-password">Confirm Password</label>
      <div class="input-wrapper">
        <input type="password" id="confirm-password" placeholder="Confirm your password" required />
        <i class="fas fa-lock input-icon"></i>
        <i class="fas fa-eye toggle-password" onclick="togglePassword(this,'confirm-password')"></i>
      </div>
      <div id="password-error" class="error-message">Passwords do not match.</div>
    </div>

    <button type="submit" class="btn btn-primary" id="register-btn">
      <i class="fas fa-user-plus"></i> Create Account
    </button>
  </form>

  <div class="links">
    <p>Already have an account? <a href="login.html">Login here</a></p>
  </div>
</div>

<script>
  const darkToggle = document.getElementById('darkToggle');
  darkToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    document.getElementById('navbar').classList.toggle('dark-mode');
    darkToggle.classList.toggle('fa-moon');
    darkToggle.classList.toggle('fa-sun');
  });

  const dobInput = document.getElementById("dob");
  const ageInput = document.getElementById("age");
  dobInput.addEventListener("change", () => {
    const dob = new Date(dobInput.value);
    const today = new Date();
    let age = today.getFullYear() - dob.getFullYear();
    const m = today.getMonth() - dob.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
    ageInput.value = age>0?age:0;
  });

  const passwordInput = document.getElementById("password");
  const confirmPasswordInput = document.getElementById("confirm-password");
  const passwordError = document.getElementById("password-error");
  const successMessage = document.getElementById("success-message");
  const strengthBar = document.getElementById("strength");
  const strengthText = document.getElementById("strength-text");
  const phoneInput = document.getElementById("phone");
  const usernameInput = document.getElementById("username");
  const emailInput = document.getElementById("email");
  const apiError = document.getElementById('api-error');

  confirmPasswordInput.addEventListener("input", () => {
    passwordError.style.display = (passwordInput.value !== confirmPasswordInput.value) ? "block" : "none";
  });

  passwordInput.addEventListener("input", () => {
    const val = passwordInput.value;
    let strength = "weak", width="33%", text="Weak password";
    if(val.length>=6 && /[A-Z]/.test(val) && /\d/.test(val)) { strength="medium"; width="66%"; text="Medium strength"; }
    if(val.length>=8 && /[A-Z]/.test(val) && /[a-z]/.test(val) && /\d/.test(val) && /[@$!%*?&]/.test(val)) { strength="strong"; width="100%"; text="Strong password"; }
    strengthBar.className = `strength-fill strength-${strength}`;
    strengthBar.style.width = width;
    strengthText.textContent = text;
  });

  function togglePassword(icon,inputId){
    const input=document.getElementById(inputId);
    if(input.type==="password"){ input.type="text"; icon.classList.replace("fa-eye","fa-eye-slash"); }
    else{ input.type="password"; icon.classList.replace("fa-eye-slash","fa-eye"); }
  }

  async function handleRegistration(event){
    event.preventDefault();
    const fullName = document.getElementById("fullname").value.trim();
    const username = usernameInput.value.trim();
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    const confirmPassword = confirmPasswordInput.value;
    const phone = phoneInput.value.trim();
    const dob = dobInput.value;
    const age = parseInt(ageInput.value);
    const registerBtn = document.getElementById('register-btn');

    successMessage.style.display="none";
    apiError.style.display="none";

    if(password !== confirmPassword){ passwordError.style.display="block"; return; }
    if(!/^\d{10}$/.test(phone)){ apiError.textContent="Phone number must be 10 digits."; apiError.style.display="block"; return; }
    if(isNaN(age) || age<18){ apiError.textContent="You must be at least 18 years old."; apiError.style.display="block"; return; }

    const strongPasswordPattern = /^.*(?=.{8,})(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).*$/;
    if(!strongPasswordPattern.test(password)){ alert("Password must be at least 8 characters long and include uppercase, lowercase, number, and special character."); return; }

    registerBtn.disabled = true;
    registerBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Creating Account...';

    try{
      const response = await fetch('http://localhost:8080/api/auth/register', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ username, email, password, full_name: fullName, phone, dob })
      });
      const data = await response.json();
      if(response.ok){
        successMessage.style.display="block";
        setTimeout(()=>window.location.href="login.html",2000);
      } else {
        apiError.textContent = data.error || "Registration failed. Try again.";
        apiError.style.display="block";
      }
    } catch(e){
      apiError.textContent="Server error. Please try again later.";
      apiError.style.display="block";
    } finally{
      registerBtn.disabled = false;
      registerBtn.innerHTML='<i class="fas fa-user-plus"></i> Create Account';
    }
  }
</script>

</body>
</html>
